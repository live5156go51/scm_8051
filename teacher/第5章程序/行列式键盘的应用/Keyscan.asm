		ORG		0000H
		AJMP	MAIN
		ORG		0030H
MAIN:	MOV		P3,#00H
		MOV		P2,#0FFH
		MOV		R0,#00H
		MOV		R1,#0F7H
		MOV		A,R0
		MOV		DPTR,#TABLE2
		MOVC	A,@A+DPTR
		MOV		P3,A

KEYSCN:	MOV		R0,#00H
		MOV		R1,#0F7H
KEYLP1:	MOV		P2,#0F0H
		MOV		A,P2
		XRL		A,#0F0H
		JZ		KEYLP1
		ACALL	DELEYMS
		MOV		P2,#0F0H
		MOV		A,P2
		XRL		A,#0F0H
		JZ		KEYLP1

KEYLP2:	MOV		P2,R1
		MOV		A,P2
	   	JB		ACC.4,NEXT1
		MOV		A,#00H
		SJMP	NEXT5
NEXT1:	JB		ACC.5,NEXT2
		MOV		A,#01H
		SJMP	NEXT5
NEXT2:	JB		ACC.6,NEXT3
		MOV		A,#02H
		SJMP	NEXT5
NEXT3:	JB		ACC.7,NEXT4
		MOV		A,#03H
		SJMP	NEXT5
NEXT4:	JNB		ACC.0,EXIT
		MOV		A,R0
		ADD		A,#04H
		MOV		R0,A
		MOV		A,R1
		RR		A
		MOV		R1,A
		SJMP	KEYLP2
NEXT5:	ADD		A,R0
		MOV		R0,A
NEXT6:	MOV		A,P2
		XRL		A,R1
		JNZ		NEXT6 ;等待按键释放
EXIT:	MOV		A,R0
		MOV		DPTR,#TABLE2
		MOVC	A,@A+DPTR
		MOV		P3,A
		SJMP	KEYSCN

DELEYMS:MOV	R7,#10		;消除抖动10毫秒
D2:		MOV	R6,#248
		DJNZ	R6,$
		DJNZ	R7,D2
		RET
TABLE2:DB 3FH,06H,5BH,4FH,66H,6DH,7DH,07H,7FH		
       DB 6FH,77H,7CH,39H,5EH,79H,71H
	   END				
		